<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset=”utf-8”>
	<title>New England Flu/Pneumonia Deaths 2016-2020</title>
		
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
	<script src="lib/d3.min.js"></script>
    	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://d3js.org/d3-queue.v3.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
 <style>
	 body {
  background-color: #373737;
}
	 .svg {
		 color: "ADD8E6";
	 }
	 h1 {text-align: center;
	 font-family: Oswald;
	 color: white;}
	 
	.gratBackground {
	fill: #9badd1;
}

.gratLines {
	fill: none;
	stroke: #bfbfbf;
	stroke-width: 1px;
}
	.otherplaces {
	fill: #FFF;
	stroke: #CCC;
	stroke-width: 2px;
}
	</style>
 </head>
<body>
	
	<h1>New England Flu/Pneumonia Deaths 2016-2020</h1>
    	<script>
 		window.onload = setMap();

		function setMap(){
	
			var map = d3.select("body")
				.append("svg")
				.attr("class", "map")
				.attr("width", 960px)
				.attr("height", 640px);

			var projection = d3.geoAlbers()
        			.center([-68.78928371378728, 43.877822762882666])
        			.rotate([-2, 0])
        			.parallels([38, 50])
        			.scale(2000)
        			.translate([width / 2, height / 2]);

			var path = d3.geoPath()
				.projection(projection);

	
			var promises = [];
				promises.push(d3.csv("Flu_deaths_New_England.csv")); 
				promises.push(d3.json("lower_48.topojson"));
				promises.push(d3.json("canada.topojson"));
				promises.push(d3.json("NE_States_flu.topojson"));
				Promise.all(promises).then(callback);

			function callback(data){

				csvData = data[0];
				us = data[1];
				canada = data[2];
				ne = data[3]:

				var graticule = d3.geoGraticule()
					.step([5, 5]);

				var gratBackground = map.append("path")
					.datum(graticule.outline()) 
					.attr("class", "gratBackground")
					.attr("d", path) 

		
				var gratLines = map.selectAll(".gratLines") 
					.data(graticule.lines()) 
		  			.enter() 
					.append("path") 
					.attr("class", "gratLines") 
					.attr("d", path); 

				var canadaBorder = topojson.feature(canada),
				var states = topojson.feature(us, us.objects.lower_48)
				var fluStates = topojson.feature(ne, ne.objects.NE_States_flu).features;			
				
		
				var cb = map.append("path")
					.datum(canadaBorder)
					.attr("class", "otherplaces")
					.attr("d", path);
				
				var uss = map.append("path")
					.datum(states)
					.attr("class", "otherplaces")
					.attr("d", path);

				var flu = map.selectAll(".flu")
					.data(fluStates)
					.enter()
					.append("path")
					.attr("class", function(d){
						return d.properties.name;
					})
					.attr("d", path);
			};
		};
			
	 </script>
	</body>
</html>
